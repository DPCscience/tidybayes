<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Add samples from the posterior fit or posterior prediction of a model to a data frame — add_predicted_samples â€¢ tidybayes</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cerulean/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">tidybayes</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/tidybayes.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/tidy-brms.html">Extracting and visualizing tidy samples from brms</a>
    </li>
    <li>
      <a href="../articles/tidy-rstanarm.html">Extracting and visualizing tidy samples from rstanarm</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mjskay/tidybayes">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Add samples from the posterior fit or posterior prediction of a model to a data frame</h1>
    </div>

    
    <p>Given a data frame and a model, adds samples from the posterior fit (aka the linear/link-level predictor)
or the posterior predictions of the model to the data frame in a long format.</p>
    

    <pre class="usage"><span class='fu'>add_predicted_samples</span>(<span class='no'>newdata</span>, <span class='no'>model</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"pred"</span>, <span class='no'>...</span>, <span class='kw'>n</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>re_formula</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>add_fitted_samples</span>(<span class='no'>newdata</span>, <span class='no'>model</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"estimate"</span>, <span class='no'>...</span>, <span class='kw'>n</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>re_formula</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>category</span> <span class='kw'>=</span> <span class='st'>"category"</span>, <span class='kw'>auxpars</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>scale</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"response"</span>, <span class='st'>"linear"</span>))

<span class='fu'>predicted_samples</span>(<span class='no'>model</span>, <span class='no'>newdata</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"pred"</span>, <span class='no'>...</span>, <span class='kw'>n</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>re_formula</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>fitted_samples</span>(<span class='no'>model</span>, <span class='no'>newdata</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"estimate"</span>, <span class='no'>...</span>, <span class='kw'>n</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>re_formula</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>category</span> <span class='kw'>=</span> <span class='st'>"category"</span>, <span class='kw'>auxpars</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>scale</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"response"</span>, <span class='st'>"linear"</span>))

<span class='co'># S3 method for default</span>
<span class='fu'>predicted_samples</span>(<span class='no'>model</span>, <span class='no'>newdata</span>, <span class='no'>...</span>)

<span class='co'># S3 method for default</span>
<span class='fu'>fitted_samples</span>(<span class='no'>model</span>, <span class='no'>newdata</span>, <span class='no'>...</span>)

<span class='co'># S3 method for stanreg</span>
<span class='fu'>predicted_samples</span>(<span class='no'>model</span>, <span class='no'>newdata</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"pred"</span>, <span class='no'>...</span>,
  <span class='kw'>n</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>re_formula</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='co'># S3 method for stanreg</span>
<span class='fu'>fitted_samples</span>(<span class='no'>model</span>, <span class='no'>newdata</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"estimate"</span>, <span class='no'>...</span>,
  <span class='kw'>n</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>re_formula</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>category</span> <span class='kw'>=</span> <span class='st'>"category"</span>, <span class='kw'>auxpars</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>scale</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"response"</span>, <span class='st'>"linear"</span>))

<span class='co'># S3 method for brmsfit</span>
<span class='fu'>predicted_samples</span>(<span class='no'>model</span>, <span class='no'>newdata</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"pred"</span>, <span class='no'>...</span>,
  <span class='kw'>n</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>re_formula</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='co'># S3 method for brmsfit</span>
<span class='fu'>fitted_samples</span>(<span class='no'>model</span>, <span class='no'>newdata</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='st'>"estimate"</span>, <span class='no'>...</span>,
  <span class='kw'>n</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>re_formula</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>category</span> <span class='kw'>=</span> <span class='st'>"category"</span>, <span class='kw'>auxpars</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>,
  <span class='kw'>scale</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"response"</span>, <span class='st'>"linear"</span>))</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>newdata</th>
      <td><p>Data frame to generate predictions from. If omitted, most model types will
generate predictions from the data used to fit the model.</p></td>
    </tr>
    <tr>
      <th>model</th>
      <td><p>A supported Bayesian model fit / MCMC object that can provide fits and predictions. Currently
supported models include <code><a href='http://www.rdocumentation.org/packages/rstanarm/topics/stanreg-objects'>stanreg-objects</a></code> (e.g. <code>rstanarm</code> models) and
<code><a href='http://www.rdocumentation.org/packages/brms/topics/brm'>brm</a></code> models. While other functions in this package (like <code><a href='spread_samples.html'>spread_samples</a></code>)
support a wider range of models, to work with <code>add_fitted_samples</code> and <code>add_predicted_samples</code>
a model must provide an interface for generating predictions, thus more generic Bayesian modeling interfaces
like <code>runjags</code> and <code>rstan</code> are not directly supported for these functions (only wrappers around
those languages that provide predictions, like <code>rstanarm</code> and <code>brm</code>, are supported here).</p></td>
    </tr>
    <tr>
      <th>var</th>
      <td><p>The name of the output column for the predictions (default <code>"pred"</code>) or fits
(default <code>"estimate"</code>, for compatibility with <code><a href='http://www.rdocumentation.org/packages/broom/topics/tidy'>tidy</a></code>).</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments passed to the underlying prediction method for the type of
model given.</p></td>
    </tr>
    <tr>
      <th>n</th>
      <td><p>The number of samples per prediction / fit to return.</p></td>
    </tr>
    <tr>
      <th>re_formula</th>
      <td><p>formula containing group-level effects to be considered in the prediction.
If <code>NULL</code> (default), include all group-level effects; if <code>NA</code>, include no group-level effects.
Some model types (such as <code><a href='http://www.rdocumentation.org/packages/brms/topics/brm'>brm</a></code> and <code><a href='http://www.rdocumentation.org/packages/rstanarm/topics/stanreg-objects'>stanreg-objects</a></code>) allow
marginalizing over grouping factors by specifying new levels of a factor in <code>newdata</code>. In the case of
<code><a href='http://www.rdocumentation.org/packages/brms/topics/brm'>brm</a></code>, you must also pass <code>allow_new_levels = TRUE</code> here to include new levels (see
<code><a href='http://www.rdocumentation.org/packages/brms/topics/predict.brmsfit'>predict.brmsfit</a></code>).</p></td>
    </tr>
    <tr>
      <th>category</th>
      <td><p>For ordinal and multinomial models, the name of the column to put the category names
into in the resulting data frame. For these models, multiple sets of rows will be returned per prediction,
one for each category.</p></td>
    </tr>
    <tr>
      <th>auxpars</th>
      <td><p>For <code>fitted_samples</code> and <code>add_fitted_samples</code>: Should auxiliary
parameters be included in the output? Valid only for models that support auxiliary parameters,
(such as submodels for variance parameters as in <code>brm</code>). If <code>TRUE</code>, auxiliary
parameters are included in the output as additional columns named after each parameter
(alternative names can be provided using a list or named vector, e.g. <code>c(sigma.hat = "sigma")</code>
would output the <code>"sigma"</code> parameter from a model as a column named <code>"sigma.hat"</code>).
If <code>FALSE</code>, auxiliary parameters are not included.</p></td>
    </tr>
    <tr>
      <th>scale</th>
      <td><p>Either <code>"response"</code> or <code>"linear"</code>. If <code>"response"</code>, results are returned
on the scale of the response variable. If <code>"linear"</code>, fitted values are returned on the scale of
the linear predictor.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A data frame (actually, a <code><a href='http://www.rdocumentation.org/packages/tibble/topics/tibble'>tibble</a></code>) with a <code>.row</code> column (a
factor grouping rows from the input <code>newdata</code>), <code>.chain</code> column (the chain
each sample came from, or <code>NA</code> if the model does not provide chain information),
<code>.iteration</code> column (the iteration the sample came from), and <code>.pred</code> column (a
sample from the posterior predictive distribution). For convenience, the resulting data
frame comes grouped by the original input rows.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p><code>add_fitted_samples</code> adds samples from the posterior linear predictor (or the "link") to
the data. It corresponds to <code><a href='http://www.rdocumentation.org/packages/rstanarm/topics/posterior_linpred.stanreg'>posterior_linpred</a></code> in <code>rstanarm</code> or
<code><a href='http://www.rdocumentation.org/packages/brms/topics/fitted.brmsfit'>fitted.brmsfit</a></code> in <code>brms</code>.
    <code>add_predicted_samples</code> adds samples from the posterior prediction to
the data. It corresponds to <code><a href='http://www.rdocumentation.org/packages/rstanarm/topics/posterior_predict.stanreg'>posterior_predict</a></code> in <code>rstanarm</code> or
<code><a href='http://www.rdocumentation.org/packages/brms/topics/predict.brmsfit'>predict.brmsfit</a></code> in <code>brms</code>.
    <code>add_fitted_samples</code> and <code>fitted_samples</code> are alternate spellings of the
same function with opposite order of the first two arguments to facilitate use in data
processing pipelines that start either with a data frame or a model. Similarly,
<code>add_predicted_samples</code> and <code>predicted_samples</code> are alternate spellings.</p>
<p>Given equal choice between the two, <code>add_fitted_samples</code> and <code>add_predicted_samples</code>
are the preferred spellings.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='spread_samples.html'>spread_samples</a></code></p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
##TODO

</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Matthew Kay

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://www.mjskay.com'>Matthew Kay</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
